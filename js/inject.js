(()=>{var _R = {A: '<span class="printuser (?:.*?WIKIDOT\\.page\\.listeners\\.userInfo\\((\\d+?)\\)[\\s\\S]*?return false;".*?>([^<>]*?)<\\/a><\\/span>|deleted" data-id="(.*?)">[\\s\\S]*?)\\s*?<span style="color:#777">([\\s\\S]*?)<\\/span>'};_R.B = new RegExp(_R.A);_R.C = new RegExp(_R.A,'g');var _d = (s)=>{return (s||"").replace(/&(?:([a-z]+?)|#(\d+?));/g, function(m,c,d) {return c ? ({"amp": "&","lt": "<","gt": ">","quot": '"',"nbsp": " "}[c] || m) : d ? String.fromCharCode(d) : m})};var _c = (k)=>(document.cookie.split(/; ?/).find(v=>v.match(k + "=")) || "").split(k + "=").join("");var _s = (s)=>{var r = {error: !0,raw: s};switch (s) {case "ok":r.desc = "正常にリクエストされました。";r.error = !1;break;case "try_again":r.desc = "再試行してください。";r.retry = !0;break;case "wrong_token7":r.desc = "トークン情報が不正です。ページをリロードしてください。";break;case "no_permission":r.desc = "ログインをしていないか、必要な権限がありません。";break;default:r.desc = "不明なエラー";break}return r};var _p = async function _f(payload={}, remind=!1) {var t = _c("wikidot_token7");var h = new Headers();h.append('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');h.append('Cookie', document.cookie);var o = Object.assign({'wikidot_token7': t}, payload);var req = await fetch('/ajax-module-connector.php', {method: 'POST',body: Object.keys(o).map(k=>`${k}=${encodeURIComponent(o[k])}`).join('&'),headers: h});var res = await req.json();var st = _s(res.status);if (st.retry) {return await _f(payload, remind)} else if (st.error) {throw new Error(st.desc)}if (remind) {console.log(st.desc)}return res};(async function _f() {if (!window.WIKIREQUEST) {return setTimeout(_f, 100)}var a = await _p({'pageId': WIKIREQUEST.info.pageId,'moduleName': 'pagerate/WhoRatedPageModule'});var b = _d(a.body).match(_R.C);var c = b ? b.map(v=>{var _ = v.match(_R.B);return {user_name: _[2],user_id: Number(_[1] || _[3]),vote_type: (_[4].trim() == "+")}}) : [];var d = c.find(v=>v.user_id == WIKIREQUEST.userId);if (d) {for (var e of document.querySelectorAll('.rate-points')) {e.innerHTML = `(${d.vote_type ? '+' : '-'})` + e.innerHTML.trim()}}})()})();
